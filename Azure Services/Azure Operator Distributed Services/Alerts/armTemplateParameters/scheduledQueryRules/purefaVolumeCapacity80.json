{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "alertName": {
      "value": "PureFA 80 Percent Volume Space Used"
    },
    "alertDescription": {
      "value": "PureFA Volume Total Capacity Alerts will query both the PureFA Volume Space Used and Volume Space Capacity logs then calculate the Percentage used based on the results, as provided by PureFA in Bytes. This Alert will trigger when volume usage surpasses 80 percent."
    },
    "alertSeverity": {
      "value": 3
    },
    "query": {
      "value": "InsightsMetrics | where Namespace == 'prometheus' and Name == 'purefa_volume_space_bytes' | extend Json = parse_json(Tags) | where Json.dimension == 'total' | extend Volume = tostring(Json.volume) | extend UsedVolumeBytes = Val | join kind=inner ( InsightsMetrics | where Namespace == 'prometheus' and Name == 'purefa_volume_space_size_bytes' | extend Json = parse_json(Tags) | extend Volume = tostring(Json.volume) | extend VolumeTotalBytes = Val) on TimeGenerated, Computer, Origin, AgentId, Type, _ResourceId, Volume | extend VolumePctUsed = UsedVolumeBytes / VolumeTotalBytes * 100 | project TimeGenerated, Computer, Origin, AgentId, Type, _ResourceId, Volume, UsedVolumeBytes, VolumeTotalBytes, VolumePctUsed"
    },
    "metricMeasureColumn": {
      "value": "VolumePctUsed"
    },
    "resourceIdColumn": {
      "value": "_ResourceId"
    },
    "operator": {
      "value": "GreaterThan"
    },
    "threshold": {
      "value": "80"
    },
    "timeAggregation": {
      "value": "Maximum"
    },
    "windowSize": {
      "value": "PT5M"
    },
    "evaluationFrequency": {
      "value": "PT1M"
    },
    "dimensions": {
      "value": [
        {
          "name": "Volume",
          "operator": "Include",
          "values": ["*"]
        }
      ]
    }
  }
}
